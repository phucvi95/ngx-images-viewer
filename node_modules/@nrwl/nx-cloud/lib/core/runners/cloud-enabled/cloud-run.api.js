const a3_0x5043=['axiosException','../../../utilities/environment','status','__esModule','../../../utilities/metric-logger','from','Run\x20completion\x20responded\x20with\x20`undefined`.','util','Run\x20Details:','headers','RUNNER_FAILURE_PERF_ENTRY','runUrl','CloudRunApi','__awaiter','note','map','post','devDependencies','getBranch','terminalOutput','/nx-cloud/runs/start','endRun','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','nxCloudVersion','gzip','response','machineInfo','toString','createMetricRecorder','../../../utilities/axios','application/octet-stream','VERBOSE_LOGGING','startRun','next','messages','@nrwl/nx-cloud','Invalid\x20end\x20run\x20response:\x20','extractErrorMessage','slice','apiError','apiAxiosInstance','data','readFileSync','then','RunEnd.\x20Completed\x20tasks','message','throw','promisify','runContext','../../../utilities/nx-imports','stringify','unknown','axiosMultipleTries','Invalid\x20Nx\x20Cloud\x20response:\x20','RunEnd\x20duration','done','createReqBody','urls','/nx-cloud/runs/end','length','recordMetric','mapRespToPerfEntry','assign'];(function(_0x60cfcb,_0x504341){const _0x212e50=function(_0x58d772){while(--_0x58d772){_0x60cfcb['push'](_0x60cfcb['shift']());}};_0x212e50(++_0x504341);}(a3_0x5043,0x7d));const a3_0x212e=function(_0x60cfcb,_0x504341){_0x60cfcb=_0x60cfcb-0x0;let _0x212e50=a3_0x5043[_0x60cfcb];return _0x212e50;};'use strict';var __awaiter=this&&this[a3_0x212e('0xe')]||function(_0x5ddd12,_0x4d8fc2,_0x292a70,_0x37ac42){function _0x264307(_0x4d39c6){return _0x4d39c6 instanceof _0x292a70?_0x4d39c6:new _0x292a70(function(_0x2baaa2){_0x2baaa2(_0x4d39c6);});}return new(_0x292a70||(_0x292a70=Promise))(function(_0x1d483c,_0x23a032){function _0x1ab98b(_0x1394c9){try{_0x16be5f(_0x37ac42['next'](_0x1394c9));}catch(_0x862e48){_0x23a032(_0x862e48);}}function _0x1fe5c4(_0xbe122f){try{_0x16be5f(_0x37ac42[a3_0x212e('0x2f')](_0xbe122f));}catch(_0x254b7f){_0x23a032(_0x254b7f);}}function _0x16be5f(_0x1dc1de){_0x1dc1de[a3_0x212e('0x38')]?_0x1d483c(_0x1dc1de['value']):_0x264307(_0x1dc1de['value'])[a3_0x212e('0x2c')](_0x1ab98b,_0x1fe5c4);}_0x16be5f((_0x37ac42=_0x37ac42['apply'](_0x5ddd12,_0x4d8fc2||[]))[a3_0x212e('0x22')]());});};Object['defineProperty'](exports,a3_0x212e('0x4'),{'value':!![]});exports[a3_0x212e('0xd')]=void 0x0;const axios_1=require(a3_0x212e('0x1e'));const environment_1=require(a3_0x212e('0x2'));const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require(a3_0x212e('0x8'));const metric_logger_1=require(a3_0x212e('0x5'));const {output}=require(a3_0x212e('0x32'));class CloudRunApi{constructor(_0x4b2b60,_0x374319,_0x578256,_0x48ebfa){this[a3_0x212e('0x23')]=_0x4b2b60;this[a3_0x212e('0x31')]=_0x374319;this[a3_0x212e('0x1b')]=_0x48ebfa;this[a3_0x212e('0x29')]=(0x0,axios_1['createApiAxiosInstance'])(_0x578256);}[a3_0x212e('0x21')](_0x2f5114,_0x476cbc){var _0x39b5c9;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x543469=(0x0,metric_logger_1[a3_0x212e('0x1d')])(a3_0x212e('0x21'));try{const _0x568b53={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'branch':(0x0,environment_1[a3_0x212e('0x13')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x2f5114,'hashes':_0x476cbc};if(environment_1[a3_0x212e('0x20')]){output['note']({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x212e('0x33')](_0x568b53,null,0x2)]});}const _0x2c550d=yield(0x0,axios_1['printDuration'])('RunStart\x20duration',()=>(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x212e('0x29')][a3_0x212e('0x11')](a3_0x212e('0x15'),_0x568b53)));_0x543469['recordMetric']((0x0,metric_logger_1[a3_0x212e('0x3e')])(_0x2c550d));if(_0x2c550d[a3_0x212e('0x2a')]&&_0x2c550d['data'][a3_0x212e('0x2e')]){this['messages'][a3_0x212e('0x2e')]=_0x2c550d['data'][a3_0x212e('0x2e')];}if(!_0x2c550d[a3_0x212e('0x2a')]||!_0x2c550d[a3_0x212e('0x2a')][a3_0x212e('0x3a')]){this['messages']['apiError']=a3_0x212e('0x36')+JSON[a3_0x212e('0x33')](_0x2c550d[a3_0x212e('0x2a')]);return{};}return _0x2c550d[a3_0x212e('0x2a')][a3_0x212e('0x3a')];}catch(_0x430093){_0x543469[a3_0x212e('0x3d')](((_0x39b5c9=_0x430093===null||_0x430093===void 0x0?void 0x0:_0x430093[a3_0x212e('0x1')])===null||_0x39b5c9===void 0x0?void 0x0:_0x39b5c9[a3_0x212e('0x1a')])?(0x0,metric_logger_1[a3_0x212e('0x3e')])(_0x430093[a3_0x212e('0x1')][a3_0x212e('0x1a')]):metric_logger_1[a3_0x212e('0xb')]);this['messages'][a3_0x212e('0x28')]=this[a3_0x212e('0x23')][a3_0x212e('0x26')](_0x430093,'api');return{};}});}[a3_0x212e('0x39')](_0x112e99,_0x1ac126,_0x248a2b){const _0xb003a2={'meta':{'nxCloudVersion':this[a3_0x212e('0x18')]()},'tasks':_0x1ac126,'run':_0x112e99,'linkId':_0x248a2b,'machineInfo':this[a3_0x212e('0x1b')]};return JSON['stringify'](_0xb003a2);}['endRun'](_0x369594,_0x4c6d16,_0x55a6f6){var _0x1af2c0,_0x24c17a;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x212e('0x23')][a3_0x212e('0x28')])return![];let _0x567158=this[a3_0x212e('0x39')](_0x369594,_0x4c6d16,_0x55a6f6);if(_0x567158[a3_0x212e('0x3c')]>0x14*0x3e8*0x3e8){_0x567158=this[a3_0x212e('0x39')](_0x369594,_0x4c6d16[a3_0x212e('0x10')](_0x334485=>Object[a3_0x212e('0x0')](Object[a3_0x212e('0x0')]({},_0x334485),{'hashDetails':undefined})));}const _0x228875=Buffer[a3_0x212e('0x6')](_0x567158);const _0x2e2f2a=yield(0x0,util_1[a3_0x212e('0x30')])(zlib_1['gzip'])(_0x228875);const _0x1b83b9=(0x0,metric_logger_1[a3_0x212e('0x1d')])(a3_0x212e('0x16'));try{if(environment_1[a3_0x212e('0x20')]){const _0x1949f9=_0x4c6d16[a3_0x212e('0x10')](_0x17eaaa=>{return Object[a3_0x212e('0x0')](Object['assign']({},_0x17eaaa),{'terminalOutput':_0x17eaaa[a3_0x212e('0x14')]?_0x17eaaa[a3_0x212e('0x14')][a3_0x212e('0x27')](0x0,0x14)+'...':undefined});});output[a3_0x212e('0xf')]({'title':a3_0x212e('0x2d'),'bodyLines':['\x0a'+JSON['stringify'](_0x1949f9,null,0x2)]});}const _0x40b49f=yield(0x0,axios_1['printDuration'])(a3_0x212e('0x37'),()=>(0x0,axios_1[a3_0x212e('0x35')])(()=>this[a3_0x212e('0x29')][a3_0x212e('0x11')](a3_0x212e('0x3b'),_0x2e2f2a,{'headers':Object[a3_0x212e('0x0')](Object[a3_0x212e('0x0')]({},this[a3_0x212e('0x29')]['defaults'][a3_0x212e('0xa')]),{'Content-Encoding':a3_0x212e('0x19'),'Content-Type':a3_0x212e('0x1f')})})));if(_0x40b49f){_0x1b83b9[a3_0x212e('0x3d')]((0x0,metric_logger_1[a3_0x212e('0x3e')])(_0x40b49f));if(_0x40b49f['data']&&_0x40b49f[a3_0x212e('0x2a')][a3_0x212e('0xc')]&&_0x40b49f['data']['status']==='success'){this[a3_0x212e('0x31')][a3_0x212e('0xc')]=_0x40b49f[a3_0x212e('0x2a')][a3_0x212e('0xc')];return!![];}if(_0x40b49f['data']&&_0x40b49f[a3_0x212e('0x2a')][a3_0x212e('0x3')]){this[a3_0x212e('0x23')][a3_0x212e('0x28')]=a3_0x212e('0x25')+JSON[a3_0x212e('0x33')](_0x40b49f[a3_0x212e('0x2a')][a3_0x212e('0x2e')]);}else if(_0x40b49f[a3_0x212e('0x2a')]&&typeof _0x40b49f[a3_0x212e('0x2a')]==='string'){if(_0x40b49f[a3_0x212e('0x2a')]!=='success'){this[a3_0x212e('0x23')][a3_0x212e('0x28')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x212e('0x33')](_0x40b49f['data']);}}else{this['messages'][a3_0x212e('0x28')]=a3_0x212e('0x25')+JSON['stringify'](_0x40b49f[a3_0x212e('0x2a')]);}if(environment_1[a3_0x212e('0x20')]){output[a3_0x212e('0xf')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON['stringify'](_0x40b49f[a3_0x212e('0x2a')],null,0x2)]});}}else{output['error']({'title':a3_0x212e('0x17'),'bodyLines':[a3_0x212e('0x7'),a3_0x212e('0x9'),JSON[a3_0x212e('0x33')](_0x369594,null,0x2),'Stack\x20Trace:',JSON[a3_0x212e('0x33')](new Error()['stack'],null,0x2)]});}return![];}catch(_0x359d68){_0x1b83b9[a3_0x212e('0x3d')](((_0x1af2c0=_0x359d68===null||_0x359d68===void 0x0?void 0x0:_0x359d68['axiosException'])===null||_0x1af2c0===void 0x0?void 0x0:_0x1af2c0[a3_0x212e('0x1a')])?(0x0,metric_logger_1[a3_0x212e('0x3e')])(_0x359d68['axiosException']['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);const _0x3afbf7=(_0x24c17a=_0x359d68['axiosException'])!==null&&_0x24c17a!==void 0x0?_0x24c17a:_0x359d68;this[a3_0x212e('0x23')][a3_0x212e('0x28')]=this[a3_0x212e('0x23')][a3_0x212e('0x26')](_0x3afbf7,'api');return![];}});}[a3_0x212e('0x18')](){try{const _0x2c6a9c=JSON['parse']((0x0,fs_1[a3_0x212e('0x2b')])('package.json')[a3_0x212e('0x1c')]());return _0x2c6a9c[a3_0x212e('0x12')][a3_0x212e('0x24')];}catch(_0x107e04){return a3_0x212e('0x34');}}}exports[a3_0x212e('0xd')]=CloudRunApi;