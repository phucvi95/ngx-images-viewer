const a1_0x52d8=['lifeCycle','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','../../../utilities/nx-imports','cachePath','uploads','enabled','__awaiter','OutputObfuscator','getBranch','processInBackground','api.nrwl.io','pathExists','taskId','runUrl','getMachineInfo','/runs/','VERBOSE_LOGGING','generateUniqueLinkId','encryptionKey','endsWith','ErrorReporterApi','EndOfRunMessage','env','cloudEnabledTasksRunner','done','../../terminal-output/output-obfuscator','../../../utilities/environment','value','FileStorage','requests','toISOString','note','__esModule','CloudRunApi','rxjs/internal/Subject','skipNxCache','assign','toString','waitForStoreRequestsToComplete','anyErrors','./cloud-remote-cache','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','indexOf','parseCommand','writeFileSync','printCacheHitsMessage','ACCESS_TOKEN','../../api/error-reporter.api','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','hash','then','tasks-hashes-','E2EEncryption','catch','subscribe','exit','printMessages','next','map','./cloud-run.api','url','https://nx.app','accessToken','cacheDirectory','endRun','message','path','startRun','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','error','daemon','.nx.app','length','stringify','../../terminal-output/end-of-run-message','join','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','throw','scan','Nx\x20Cloud\x20Problems','getRunGroup'];(function(_0x4fbe33,_0x52d894){const _0x14a2d3=function(_0x8d08b5){while(--_0x8d08b5){_0x4fbe33['push'](_0x4fbe33['shift']());}};_0x14a2d3(++_0x52d894);}(a1_0x52d8,0x1b3));const a1_0x14a2=function(_0x4fbe33,_0x52d894){_0x4fbe33=_0x4fbe33-0x0;let _0x14a2d3=a1_0x52d8[_0x4fbe33];return _0x14a2d3;};'use strict';var __awaiter=this&&this[a1_0x14a2('0x39')]||function(_0x574f3d,_0x169e45,_0x35e293,_0x31dbe4){function _0x2bfd26(_0x410bb3){return _0x410bb3 instanceof _0x35e293?_0x410bb3:new _0x35e293(function(_0x4fdf31){_0x4fdf31(_0x410bb3);});}return new(_0x35e293||(_0x35e293=Promise))(function(_0x1b756e,_0x33ee99){function _0x1f4ec8(_0x248a10){try{_0x3e6460(_0x31dbe4[a1_0x14a2('0x1b')](_0x248a10));}catch(_0x4f2bd3){_0x33ee99(_0x4f2bd3);}}function _0x39e07c(_0x3cb38f){try{_0x3e6460(_0x31dbe4[a1_0x14a2('0x2f')](_0x3cb38f));}catch(_0x2699bc){_0x33ee99(_0x2699bc);}}function _0x3e6460(_0x58aa37){_0x58aa37[a1_0x14a2('0x4b')]?_0x1b756e(_0x58aa37[a1_0x14a2('0x4e')]):_0x2bfd26(_0x58aa37[a1_0x14a2('0x4e')])[a1_0x14a2('0x14')](_0x1f4ec8,_0x39e07c);}_0x3e6460((_0x31dbe4=_0x31dbe4['apply'](_0x574f3d,_0x169e45||[]))['next']());});};Object['defineProperty'](exports,a1_0x14a2('0x2'),{'value':!![]});exports[a1_0x14a2('0x4a')]=void 0x0;const message_reporter_1=require('../../terminal-output/message-reporter');const end_of_run_message_1=require(a1_0x14a2('0x2c'));const output_obfuscator_1=require(a1_0x14a2('0x4c'));const cloud_enabled_life_cycle_1=require('./cloud-enabled-life-cycle');const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require('../../file-storage/e2e-encryption');const environment_1=require(a1_0x14a2('0x4d'));const cloud_remote_cache_1=require(a1_0x14a2('0xa'));const cloud_run_api_1=require(a1_0x14a2('0x1d'));const fs_1=require('fs');const path=require(a1_0x14a2('0x24'));const metric_logger_1=require('../../../utilities/metric-logger');const error_reporter_api_1=require(a1_0x14a2('0x11'));const path_1=require(a1_0x14a2('0x24'));const fs_extra_1=require('fs-extra');const id_generator_1=require('./id-generator');const {tasksRunner,output,Cache}=require(a1_0x14a2('0x35'));function createApi(_0x46c245,_0x100982,_0x50d874){const _0x43dc04=(0x0,environment_1[a1_0x14a2('0x41')])(_0x100982);return new cloud_run_api_1[(a1_0x14a2('0x3'))](_0x46c245,_0x50d874,_0x100982,_0x43dc04);}function storeTaskHashes(_0x388dc2,_0x432900,_0xafbeda){const _0x487fff=JSON[a1_0x14a2('0x2b')](_0x388dc2[a1_0x14a2('0x1c')](_0x5115b2=>({'taskId':_0x5115b2[a1_0x14a2('0x3f')],'hash':_0x5115b2[a1_0x14a2('0x13')]})));if(environment_1[a1_0x14a2('0x43')]){output[a1_0x14a2('0x1')]({'title':'Executed\x20tasks\x20with\x20hashes:\x20'+_0x487fff});}(0x0,fs_1[a1_0x14a2('0xe')])(path['join'](_0x432900,a1_0x14a2('0x15')+_0xafbeda),_0x487fff);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x199144=new Date()[a1_0x14a2('0x0')]();const _0x41b63b=(0x0,environment_1[a1_0x14a2('0x3b')])();const _0x431e7e={'command':outputObfuscator['obfuscate']((0x0,environment_1[a1_0x14a2('0xd')])()),'startTime':runStartTime,'endTime':_0x199144,'distributedExecutionId':environment_1[a1_0x14a2('0x2e')],'branch':_0x41b63b,'scan':!![],'runGroup':(0x0,environment_1[a1_0x14a2('0x32')])(),'sha':_0x41b63b?(0x0,environment_1['extractGitSha'])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x14a2('0x34')]){storeTaskHashes(taskExecutions,options[a1_0x14a2('0x21')]||'./node_modules/.cache/nx',environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID']);}try{yield remoteCache[a1_0x14a2('0x8')]();}catch(_0x296dbf){output[a1_0x14a2('0x27')]({'title':a1_0x14a2('0x12')});messages[a1_0x14a2('0x1a')]();process['exit'](environment_1[a1_0x14a2('0xb')]);}try{yield api[a1_0x14a2('0x22')](_0x431e7e,taskExecutions);}catch(_0x5bca09){output[a1_0x14a2('0x27')]({'title':a1_0x14a2('0x26')});messages[a1_0x14a2('0x1a')]();process[a1_0x14a2('0x19')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}yield(0x0,metric_logger_1['submitRunMetrics'])(options);}else{try{const _0x15c1a6=environment_1[a1_0x14a2('0x10')]?environment_1['ACCESS_TOKEN']:options[a1_0x14a2('0x20')];const _0x33d147=(0x0,id_generator_1[a1_0x14a2('0x44')])();yield daemon[a1_0x14a2('0x3c')]('@nrwl/nx-cloud/lib/daemon/process-run-end',{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x14a2('0x6')](Object[a1_0x14a2('0x6')]({},options),{'accessToken':_0x15c1a6}),'uploads':fileStorage[a1_0x14a2('0x37')],'runEnd':{'runData':_0x431e7e,'taskExecutions':taskExecutions,'linkId':_0x33d147}});runContext[a1_0x14a2('0x40')]=(options['url']||a1_0x14a2('0x1f'))+a1_0x14a2('0x42')+_0x33d147;}catch(_0x58f278){output['warn']({'title':a1_0x14a2('0x31'),'bodyLines':[_0x58f278[a1_0x14a2('0x23')]||_0x58f278[a1_0x14a2('0x7')]()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages['printMessages']();if(!messages[a1_0x14a2('0x9')]&&!inner){endOfRunMessage[a1_0x14a2('0xf')]();}},0x0);}else{messages['printMessages']();if(!messages[a1_0x14a2('0x9')]&&!inner){endOfRunMessage[a1_0x14a2('0xf')]();}}});}function createLifeCycle(_0x25f71b,_0x1ff057,_0x23bd93,_0x1848d9){const _0x2b87f1=new cloud_enabled_life_cycle_1['CloudEnabledLifeCycle'](_0x25f71b,_0x1ff057['cacheDirectory'],!!_0x1ff057[a1_0x14a2('0x5')],_0x1ff057[a1_0x14a2('0x30')]===undefined?!![]:_0x1ff057[a1_0x14a2('0x30')],_0x1ff057['cacheableOperations']||[],_0x23bd93,_0x1848d9);try{const {CompositeLifeCycle}=require(a1_0x14a2('0x35'));if(!CompositeLifeCycle)return _0x2b87f1;return new CompositeLifeCycle([_0x1ff057[a1_0x14a2('0x33')],_0x2b87f1]);}catch(_0x313ad0){return _0x2b87f1;}}function fetchUrlsForKnownHashesUpfront(_0x4352d3,_0x92659d,_0x5d0df5,_0x35f3ee){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x5dfdc=_0x5d0df5[a1_0x14a2('0x1c')](_0x3ac38c=>_0x3ac38c[a1_0x14a2('0x13')])['filter'](_0x4c5d69=>!!_0x4c5d69);const _0x32342f=new Cache(_0x35f3ee);if(!_0x35f3ee[a1_0x14a2('0x5')]){const _0x6ab78b=yield Promise['all'](_0x5dfdc[a1_0x14a2('0x1c')](_0x52499f=>{const _0x2e3bd5=(0x0,path_1[a1_0x14a2('0x2d')])(_0x32342f[a1_0x14a2('0x36')],_0x52499f+'.commit');return(0x0,fs_extra_1[a1_0x14a2('0x3e')])(_0x2e3bd5);}));const _0x38aaeb=[];for(let _0x4e47eb=0x0;_0x4e47eb<_0x6ab78b[a1_0x14a2('0x2a')];++_0x4e47eb){if(_0x6ab78b[_0x4e47eb]){_0x38aaeb['push'](_0x5dfdc[_0x4e47eb]);}}_0x5dfdc=_0x38aaeb;}if(_0x5dfdc[a1_0x14a2('0x2a')]>0x0){const _0x660b64=_0x4352d3[a1_0x14a2('0x25')](environment_1[a1_0x14a2('0x2e')],_0x5dfdc);for(const _0x199785 of _0x5dfdc){_0x92659d[a1_0x14a2('0x50')][_0x199785]=_0x660b64;}}});}function isConnectedToPrivateCloud(_0x4cfb09){if(!_0x4cfb09[a1_0x14a2('0x1e')])return![];if(_0x4cfb09['url'][a1_0x14a2('0x46')](a1_0x14a2('0x3d')))return![];if(_0x4cfb09[a1_0x14a2('0x1e')][a1_0x14a2('0x46')](a1_0x14a2('0x29')))return![];if(_0x4cfb09[a1_0x14a2('0x1e')][a1_0x14a2('0xc')]('localhost')>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x4babb4,_0x406e98,_0x3f39af,_0x4cb693=![]){var _0x33f889;const _0x2850d4={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x4babb4};const _0x9a5db=_0x406e98[a1_0x14a2('0x33')]===undefined;const _0x3e5646=[];const _0x24254f=new message_reporter_1['MessageReporter'](_0x406e98);const _0x493e4a=createApi(_0x24254f,_0x406e98,_0x2850d4);const _0x265377=new end_of_run_message_1[(a1_0x14a2('0x48'))](_0x2850d4,_0x3e5646);const _0x527a06=new output_obfuscator_1[(a1_0x14a2('0x3a'))](_0x406e98['maskedProperties']);const _0x34463a=new Date()[a1_0x14a2('0x0')]();const _0x136819=createLifeCycle(_0x2850d4,_0x406e98,_0x527a06,_0x3e5646);const _0x9beea9=environment_1['ENCRYPTION_KEY']||_0x406e98[a1_0x14a2('0x45')];const _0x5b7a5f=new e2e_encryption_1[(a1_0x14a2('0x16'))](_0x9beea9);const _0x511040=new error_reporter_api_1[(a1_0x14a2('0x47'))](_0x406e98);const _0x132270=!!environment_1[a1_0x14a2('0x34')]||!((_0x33f889=_0x3f39af[a1_0x14a2('0x28')])===null||_0x33f889===void 0x0?void 0x0:_0x33f889[a1_0x14a2('0x38')]())||isConnectedToPrivateCloud(_0x406e98);const _0x26b28a=new file_storage_1[(a1_0x14a2('0x4f'))](_0x5b7a5f,_0x511040,![],_0x132270);const _0x5ae23c=new cloud_remote_cache_1['CloudRemoteCache'](_0x24254f,_0x493e4a,_0x2850d4,_0x26b28a);fetchUrlsForKnownHashesUpfront(_0x493e4a,_0x2850d4,_0x4babb4,_0x406e98);delete process[a1_0x14a2('0x49')][a1_0x14a2('0x2e')];const _0x26dc91=tasksRunner(_0x4babb4,Object['assign'](Object[a1_0x14a2('0x6')]({},_0x406e98),{'remoteCache':_0x5ae23c,'lifeCycle':_0x136819}),_0x3f39af);if(_0x26dc91[a1_0x14a2('0x18')]){const {Subject}=require(a1_0x14a2('0x4'));const _0x248577=new Subject();_0x26dc91[a1_0x14a2('0x18')]({'next':_0x50085d=>_0x248577['next'](_0x50085d),'error':_0x56829a=>_0x248577['error'](_0x56829a),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x3f39af['daemon'],'lifeCycle':_0x136819,'options':_0x406e98,'remoteCache':_0x5ae23c,'api':_0x493e4a,'outputObfuscator':_0x527a06,'runStartTime':_0x34463a,'messages':_0x24254f,'endOfRunMessage':_0x265377,'taskExecutions':_0x3e5646,'versionOfNxBefore133':_0x9a5db,'inner':_0x4cb693,'encryptionKey':_0x9beea9,'fileStorage':_0x26b28a,'uploadInCurrentProcess':_0x132270,'runContext':_0x2850d4});_0x248577['complete']();})});return _0x248577;}else{return _0x26dc91[a1_0x14a2('0x14')](_0x47f754=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x3f39af[a1_0x14a2('0x28')],'lifeCycle':_0x136819,'options':_0x406e98,'remoteCache':_0x5ae23c,'api':_0x493e4a,'outputObfuscator':_0x527a06,'runStartTime':_0x34463a,'messages':_0x24254f,'endOfRunMessage':_0x265377,'taskExecutions':_0x3e5646,'versionOfNxBefore133':_0x9a5db,'inner':_0x4cb693,'encryptionKey':_0x9beea9,'fileStorage':_0x26b28a,'uploadInCurrentProcess':_0x132270,'runContext':_0x2850d4});return _0x47f754;}))[a1_0x14a2('0x17')](_0x15d830=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x3f39af['daemon'],'lifeCycle':_0x136819,'options':_0x406e98,'remoteCache':_0x5ae23c,'api':_0x493e4a,'outputObfuscator':_0x527a06,'runStartTime':_0x34463a,'messages':_0x24254f,'endOfRunMessage':_0x265377,'taskExecutions':_0x3e5646,'versionOfNxBefore133':_0x9a5db,'inner':_0x4cb693,'encryptionKey':_0x9beea9,'fileStorage':_0x26b28a,'uploadInCurrentProcess':_0x132270,'runContext':_0x2850d4});throw _0x15d830;}));}}exports['cloudEnabledTasksRunner']=cloudEnabledTasksRunner;